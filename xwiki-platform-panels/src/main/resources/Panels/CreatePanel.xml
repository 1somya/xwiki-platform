<?xml version="1.0" encoding="ISO-8859-1"?>

<xwikidoc>
<web>Panels</web>
<name>CreatePanel</name>
<language></language>
<defaultLanguage>en</defaultLanguage>
<translation>0</translation>
<parent>Panels.WebHome</parent>
<creator>XWiki.Admin</creator>
<author>XWiki.Admin</author>
<customClass></customClass>
<contentAuthor>XWiki.Admin</contentAuthor>
<creationDate>1157312105000</creationDate>
<date>1225912240000</date>
<contentUpdateDate>1225912240000</contentUpdateDate>
<version>1.1</version>
<title>Create new panel</title>
<template></template>
<defaultTemplate></defaultTemplate>
<validationScript></validationScript>
<comment></comment>
<minorEdit>false</minorEdit>
<syntaxId>xwiki/1.0</syntaxId>
<content>#macro(displayCreatePanelForm)
  &lt;form method="post" action="$doc.getURL('view', 'xpage=plain')" onsubmit="cancelCancelEdit()"&gt;
    &lt;div&gt;
      &lt;input type="hidden" name="create" value="1"/&gt;
      Create new panel: &lt;input type="text" name="panelTitle" value="Panel Title" class="panelinput" onfocus="if(this.value=='Panel Title') this.value=''" onblur="if(this.value=='') this.value='Panel Title'"/&gt;
      &lt;input type="submit" class="button" value="$msg.get("create")"/&gt;
    &lt;/div&gt;
  &lt;/form&gt;
#end
#macro(createPanel $title)
  #set($docName=$title.replaceAll(':', '%3A'))
  #set($displayTitle = $title)
  #set($displayTitle = $displayTitle.replaceAll('&amp;(?!#)', '&amp;#38;'))
  #set($displayTitle = $displayTitle.replaceAll('\\', '&amp;#92;'))
  #set($panelName = $displayTitle)
  #set($panelName = $util.encodeURI($panelName))
  #set($displayTitle = $displayTitle.replaceAll("'", '&amp;#39;'))
  #set($template = "$!{request.getParameter('template')}")
  #if($template == "")
    #set($template="Panels.PanelTemplate")
  #end
  #set($pcontent = "#")
  #set($pcontent = "${pcontent}panelheader('${displayTitle}')${util.getNewline()}${util.getNewline()}#")
  #set($pcontent = "${pcontent}panelfooter()")
  #set($pcontent = $util.encodeURI($pcontent))
  #set($redirectaction = "inline")
  #set($redirectparams = "template=${template}&amp;Panels.PanelClass_0_name=${panelName}&amp;Panels.PanelClass_0_content=$pcontent")
  #set($newdoc=$xwiki.getDocument($docName))
  #if(!$newdoc.isNew())
    #set($redirecturl = $newdoc.getURL("view", "xpage=docalreadyexists"))
  #else
    #set($redirecturl = $newdoc.getURL($redirectaction, $redirectparams))
  #end
  $response.sendRedirect($redirecturl)
$title
#end
#if("$!{request.create}" == '')
  #displayCreatePanelForm()
#else
  #createPanel("$!{request.getParameter('panelTitle')}")
#end</content>
</xwikidoc>
