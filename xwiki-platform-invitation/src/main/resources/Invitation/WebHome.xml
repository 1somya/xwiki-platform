<?xml version="1.0" encoding="UTF-8"?>
<xwikidoc>
<web>Invitation</web>
<name>WebHome</name>
<language></language>
<defaultLanguage>en</defaultLanguage>
<translation>0</translation>
<parent>Main.WebHome</parent>
<creator>XWiki.Admin</creator>
<author>XWiki.Admin</author>
<customClass></customClass>
<contentAuthor>XWiki.Admin</contentAuthor>
<creationDate>1271083477000</creationDate>
<date>1271850308000</date>
<contentUpdateDate>1271850308000</contentUpdateDate>
<version>1.1</version>
<title></title>
<template></template>
<defaultTemplate></defaultTemplate>
<validationScript></validationScript>
<comment></comment>
<minorEdit>false</minorEdit>
<syntaxId>xwiki/2.0</syntaxId>
<hidden>false</hidden>
<attachment>
<filename>InvitationSectionIcon.png</filename>
<filesize>8014</filesize>
<author>XWiki.Admin</author>
<date>1277060767000</date>
<version>1.1</version>
<comment></comment><content>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</content>
</attachment>
<class>
<name>Invitation.WebHome</name>
<customClass></customClass>
<customMapping></customMapping>
<defaultViewSheet></defaultViewSheet>
<defaultEditSheet></defaultEditSheet>
<defaultWeb></defaultWeb>
<nameField></nameField>
<validationScript></validationScript>
<allowUsersOfOtherWikis>
<defaultValue></defaultValue>
<displayFormType>checkbox</displayFormType>
<displayType></displayType>
<name>allowUsersOfOtherWikis</name>
<number>4</number>
<prettyName>Let users of other wikis send</prettyName>
<unmodifiable>0</unmodifiable>
<validationMessage></validationMessage>
<validationRegExp></validationRegExp>
<classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>
</allowUsersOfOtherWikis>
<commonPage>
<name>commonPage</name>
<number>18</number>
<picker>0</picker>
<prettyName>common</prettyName>
<size>30</size>
<unmodifiable>0</unmodifiable>
<validationMessage></validationMessage>
<validationRegExp></validationRegExp>
<classType>com.xpn.xwiki.objects.classes.StringClass</classType>
</commonPage>
<emailClass>
<name>emailClass</name>
<number>5</number>
<picker>0</picker>
<prettyName>Email message XClass</prettyName>
<size>30</size>
<unmodifiable>0</unmodifiable>
<validationMessage></validationMessage>
<validationRegExp></validationRegExp>
<classType>com.xpn.xwiki.objects.classes.StringClass</classType>
</emailClass>
<emailContainer>
<name>emailContainer</name>
<number>9</number>
<picker>0</picker>
<prettyName>Document containing email XObjects</prettyName>
<size>30</size>
<unmodifiable>0</unmodifiable>
<validationMessage></validationMessage>
<validationRegExp></validationRegExp>
<classType>com.xpn.xwiki.objects.classes.StringClass</classType>
</emailContainer>
<emailRegex>
<name>emailRegex</name>
<number>7</number>
<picker>0</picker>
<prettyName>Regular expression for validating email addresses</prettyName>
<size>30</size>
<unmodifiable>0</unmodifiable>
<validationMessage></validationMessage>
<validationRegExp></validationRegExp>
<classType>com.xpn.xwiki.objects.classes.StringClass</classType>
</emailRegex>
<from_address>
<name>from_address</name>
<number>1</number>
<picker>0</picker>
<prettyName>Email "from" address</prettyName>
<size>30</size>
<unmodifiable>0</unmodifiable>
<validationMessage></validationMessage>
<validationRegExp></validationRegExp>
<classType>com.xpn.xwiki.objects.classes.StringClass</classType>
</from_address>
<guestsActionsPage>
<name>guestsActionsPage</name>
<number>14</number>
<picker>0</picker>
<prettyName>guestsActions</prettyName>
<size>30</size>
<unmodifiable>0</unmodifiable>
<validationMessage></validationMessage>
<validationRegExp></validationRegExp>
<classType>com.xpn.xwiki.objects.classes.StringClass</classType>
</guestsActionsPage>
<javamail_extra_props>
<editor>---</editor>
<name>javamail_extra_props</name>
<number>15</number>
<picker>0</picker>
<prettyName>Javamail extra properties</prettyName>
<rows>5</rows>
<size>40</size>
<unmodifiable>0</unmodifiable>
<validationMessage></validationMessage>
<validationRegExp></validationRegExp>
<classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>
</javamail_extra_props>
<mainPage>
<name>mainPage</name>
<number>19</number>
<picker>0</picker>
<prettyName>mainPage</prettyName>
<size>30</size>
<unmodifiable>0</unmodifiable>
<validationMessage></validationMessage>
<validationRegExp></validationRegExp>
<classType>com.xpn.xwiki.objects.classes.StringClass</classType>
</mainPage>
<membersActionsPage>
<name>membersActionsPage</name>
<number>16</number>
<picker>0</picker>
<prettyName>membersActions</prettyName>
<size>30</size>
<unmodifiable>0</unmodifiable>
<validationMessage></validationMessage>
<validationRegExp></validationRegExp>
<classType>com.xpn.xwiki.objects.classes.StringClass</classType>
</membersActionsPage>
<membersCommonPage>
<name>membersCommonPage</name>
<number>17</number>
<picker>0</picker>
<prettyName>membersCommon</prettyName>
<size>30</size>
<unmodifiable>0</unmodifiable>
<validationMessage></validationMessage>
<validationRegExp></validationRegExp>
<classType>com.xpn.xwiki.objects.classes.StringClass</classType>
</membersCommonPage>
<messageBodyTemplate>
<editor>---</editor>
<name>messageBodyTemplate</name>
<number>3</number>
<picker>0</picker>
<prettyName>Email message body HTML template</prettyName>
<rows>5</rows>
<size>40</size>
<unmodifiable>0</unmodifiable>
<validationMessage></validationMessage>
<validationRegExp></validationRegExp>
<classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>
</messageBodyTemplate>
<smtp_port>
<name>smtp_port</name>
<number>13</number>
<picker>0</picker>
<prettyName>Smtp port</prettyName>
<size>30</size>
<unmodifiable>0</unmodifiable>
<validationMessage></validationMessage>
<validationRegExp></validationRegExp>
<classType>com.xpn.xwiki.objects.classes.StringClass</classType>
</smtp_port>
<smtp_server>
<name>smtp_server</name>
<number>12</number>
<picker>0</picker>
<prettyName>Smtp server host name</prettyName>
<size>30</size>
<unmodifiable>0</unmodifiable>
<validationMessage></validationMessage>
<validationRegExp></validationRegExp>
<classType>com.xpn.xwiki.objects.classes.StringClass</classType>
</smtp_server>
<smtp_server_password>
<name>smtp_server_password</name>
<number>11</number>
<picker>0</picker>
<prettyName>Smtp password</prettyName>
<size>30</size>
<unmodifiable>0</unmodifiable>
<validationMessage></validationMessage>
<validationRegExp></validationRegExp>
<classType>com.xpn.xwiki.objects.classes.StringClass</classType>
</smtp_server_password>
<smtp_server_username>
<name>smtp_server_username</name>
<number>10</number>
<picker>0</picker>
<prettyName>Smtp username</prettyName>
<size>30</size>
<unmodifiable>0</unmodifiable>
<validationMessage></validationMessage>
<validationRegExp></validationRegExp>
<classType>com.xpn.xwiki.objects.classes.StringClass</classType>
</smtp_server_username>
<subjectLineTemplate>
<name>subjectLineTemplate</name>
<number>2</number>
<picker>0</picker>
<prettyName>Email subject line template</prettyName>
<size>30</size>
<unmodifiable>0</unmodifiable>
<validationMessage></validationMessage>
<validationRegExp></validationRegExp>
<classType>com.xpn.xwiki.objects.classes.StringClass</classType>
</subjectLineTemplate>
<usersMayPersonalizeMessage>
<defaultValue></defaultValue>
<displayFormType>checkbox</displayFormType>
<displayType></displayType>
<name>usersMayPersonalizeMessage</name>
<number>8</number>
<prettyName>Let users personalize messages</prettyName>
<unmodifiable>0</unmodifiable>
<validationMessage></validationMessage>
<validationRegExp></validationRegExp>
<classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>
</usersMayPersonalizeMessage>
<usersMaySendToMultiple>
<defaultValue></defaultValue>
<displayFormType>checkbox</displayFormType>
<displayType></displayType>
<name>usersMaySendToMultiple</name>
<number>6</number>
<prettyName>Let users send to multiple addresses</prettyName>
<unmodifiable>0</unmodifiable>
<validationMessage></validationMessage>
<validationRegExp></validationRegExp>
<classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>
</usersMaySendToMultiple>
<messageBodyTemplatePlain>
<editor>---</editor>
<name>messageBodyTemplatePlain</name>
<number>20</number>
<picker>0</picker>
<prettyName>Message body plain text template</prettyName>
<rows>5</rows>
<size>40</size>
<unmodifiable>0</unmodifiable>
<validationMessage></validationMessage>
<validationRegExp></validationRegExp>
<classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>
</messageBodyTemplatePlain>
</class>
<object>
<class>
<name>XWiki.ConfigurableClass</name>
<customClass></customClass>
<customMapping></customMapping>
<defaultViewSheet></defaultViewSheet>
<defaultEditSheet></defaultEditSheet>
<defaultWeb></defaultWeb>
<nameField></nameField>
<validationScript></validationScript>
<codeToExecute>
<editor>---</editor>
<name>codeToExecute</name>
<number>7</number>
<picker>0</picker>
<prettyName>codeToExecute</prettyName>
<rows>5</rows>
<size>40</size>
<unmodifiable>0</unmodifiable>
<validationMessage></validationMessage>
<validationRegExp></validationRegExp>
<classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>
</codeToExecute>
<configurationClass>
<name>configurationClass</name>
<number>3</number>
<picker>0</picker>
<prettyName>configurationClass</prettyName>
<size>30</size>
<unmodifiable>0</unmodifiable>
<validationMessage></validationMessage>
<validationRegExp></validationRegExp>
<classType>com.xpn.xwiki.objects.classes.StringClass</classType>
</configurationClass>
<configureGlobally>
<defaultValue></defaultValue>
<displayFormType>checkbox</displayFormType>
<displayType></displayType>
<name>configureGlobally</name>
<number>4</number>
<prettyName>configureGlobally</prettyName>
<unmodifiable>0</unmodifiable>
<validationMessage></validationMessage>
<validationRegExp></validationRegExp>
<classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>
</configureGlobally>
<displayInSection>
<name>displayInSection</name>
<number>1</number>
<picker>0</picker>
<prettyName>displayInSection</prettyName>
<size>30</size>
<unmodifiable>0</unmodifiable>
<validationMessage></validationMessage>
<validationRegExp></validationRegExp>
<classType>com.xpn.xwiki.objects.classes.StringClass</classType>
</displayInSection>
<heading>
<name>heading</name>
<number>2</number>
<picker>0</picker>
<prettyName>heading</prettyName>
<size>30</size>
<unmodifiable>0</unmodifiable>
<validationMessage></validationMessage>
<validationRegExp></validationRegExp>
<classType>com.xpn.xwiki.objects.classes.StringClass</classType>
</heading>
<iconAttachment>
<name>iconAttachment</name>
<number>8</number>
<picker>0</picker>
<prettyName>iconAttachment</prettyName>
<size>30</size>
<unmodifiable>0</unmodifiable>
<validationMessage></validationMessage>
<validationRegExp></validationRegExp>
<classType>com.xpn.xwiki.objects.classes.StringClass</classType>
</iconAttachment>
<linkPrefix>
<name>linkPrefix</name>
<number>5</number>
<picker>0</picker>
<prettyName>linkPrefix</prettyName>
<size>30</size>
<unmodifiable>0</unmodifiable>
<validationMessage></validationMessage>
<validationRegExp></validationRegExp>
<classType>com.xpn.xwiki.objects.classes.StringClass</classType>
</linkPrefix>
<propertiesToShow>
<cache>0</cache>
<displayType>input</displayType>
<multiSelect>1</multiSelect>
<name>propertiesToShow</name>
<number>6</number>
<picker>0</picker>
<prettyName>propertiesToShow</prettyName>
<relationalStorage>1</relationalStorage>
<separator> </separator>
<separators> ,|</separators>
<size>20</size>
<sort>none</sort>
<unmodifiable>0</unmodifiable>
<validationMessage></validationMessage>
<validationRegExp></validationRegExp>
<values></values>
<classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>
</propertiesToShow>
</class>
<name>Invitation.WebHome</name>
<number>0</number>
<className>XWiki.ConfigurableClass</className>
<guid>1c92a63a-fb97-41e7-8fb5-adb134b4b4f0</guid>
<property>
<codeToExecute>## If there is no Invitation.InvitationConfig then create one.
## TODO Find a nicer way to handle this.
#if(!$xwiki.exists('Invitation.InvitationConfig'))
  {{include document="Invitation.WebHome" context="new" output="false"/}}
  #if($request.getParameter('redirected'))
    {{error}}$msg.get('xe.invitation.failedToCreateDocuments'){{/error}}
  #else
    $response.sendRedirect(
      $request.getRequestURL().append("?").append(
        $request.getQueryString()).append("&amp;redirected=1").toString())
  #end
#end</codeToExecute>
</property>
<property>
<configurationClass></configurationClass>
</property>
<property>
<configureGlobally>1</configureGlobally>
</property>
<property>
<displayInSection>Invitation</displayInSection>
</property>
<property>
<heading></heading>
</property>
<property>
<iconAttachment>InvitationSectionIcon.png</iconAttachment>
</property>
<property>
<linkPrefix></linkPrefix>
</property>
<property>
<propertiesToShow/>
</property>
</object>
<object>
<class>
<name>XWiki.XWikiRights</name>
<customClass></customClass>
<customMapping></customMapping>
<defaultViewSheet></defaultViewSheet>
<defaultEditSheet></defaultEditSheet>
<defaultWeb></defaultWeb>
<nameField></nameField>
<validationScript></validationScript>
<allow>
<defaultValue>1</defaultValue>
<displayFormType>select</displayFormType>
<displayType>allow</displayType>
<name>allow</name>
<number>4</number>
<prettyName>Allow/Deny</prettyName>
<unmodifiable>0</unmodifiable>
<classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>
</allow>
<groups>
<cache>0</cache>
<displayType>select</displayType>
<multiSelect>1</multiSelect>
<name>groups</name>
<number>1</number>
<prettyName>Groups</prettyName>
<relationalStorage>0</relationalStorage>
<separator> </separator>
<size>5</size>
<unmodifiable>0</unmodifiable>
<usesList>1</usesList>
<classType>com.xpn.xwiki.objects.classes.GroupsClass</classType>
</groups>
<levels>
<cache>0</cache>
<displayType>select</displayType>
<multiSelect>1</multiSelect>
<name>levels</name>
<number>2</number>
<prettyName>Levels</prettyName>
<relationalStorage>0</relationalStorage>
<separator> </separator>
<size>3</size>
<unmodifiable>0</unmodifiable>
<classType>com.xpn.xwiki.objects.classes.LevelsClass</classType>
</levels>
<users>
<cache>0</cache>
<displayType>select</displayType>
<multiSelect>1</multiSelect>
<name>users</name>
<number>3</number>
<prettyName>Users</prettyName>
<relationalStorage>0</relationalStorage>
<separator> </separator>
<size>5</size>
<unmodifiable>0</unmodifiable>
<usesList>1</usesList>
<classType>com.xpn.xwiki.objects.classes.UsersClass</classType>
</users>
</class>
<name>Invitation.WebHome</name>
<number>0</number>
<className>XWiki.XWikiRights</className>
<guid>649d5273-d662-4248-abf0-94953088e98a</guid>
<property>
<allow>1</allow>
</property>
<property>
<groups>XWiki.XWikiAllGroup,</groups>
</property>
<property>
<levels>view</levels>
</property>
<property>
<users></users>
</property>
</object>
<content>{{include document="Invitation.InvitationCommon" /}}

{{include document="Invitation.InvitationMembersCommon" /}}

{{velocity}}
#*
 * Invitation Application
 * This script is only for sending messages and users who are not allowed to send mail need not have access to
 * view this page.
 *
 * Macros in this script don't rely on any variables except those which are passed to them and the following:
 *
 * $doc the com.xpn.xwiki.api.Document object representing the document containing this code.
 * $msg the internationalization message provider containing a get(String) and a get(String, List) function
 * $xcontext the com.xpn.xwiki.Context object for this request
 * $xwiki an object of the com.xpn.xwiki.api.XWiki class.
 *
 * Macros also depend on other macros but only other macros which are contained in this script.
 *
 * This script relies on the following documents:
 *
 * InvitationCommon
 *
 * InvitationMembersCommon
 * 
 *
 * This script is affected by the following documents:
 *
 * InvitationMessages stores all of the mail message objects. If this does not exist it will be created.
 *                    May be changed in the configuration.
 *
 * InvitationMailClass the class for mail message objects. May be changed in the configuration.
 *
 * InvitationConfig configuration for this code. Contains an XObject of the class defined in this document.
 *                  If it does not exist it will be created with default values.
 *
 *###
#if($xcontext.getUser() == 'XWiki.XWikiGuest')
  ## Only members should ever have access to this document, enforce this through XWiki permissions system,
  ## this is a last effort in the event of incorrect settings.
  #stop
#end
##
## is the user a mail admin TODO: change this.
#set($isAdmin = $hasEdit)
##
## Load config and mail.
#set($config = {})
#loadInvitationConfig($config)
#set($mail = {})
#loadInvitationMail($config, $mail)
##
## Load CSS
$xwiki.get('ssx').use($config.get('commonPage'))
##
## Don't load comments, history, etc.
#set($docextras = [])
##
#displayInvitationHeader($request.getParameterMap(), $config)
##
##---------------------------------------------------------------------
## Decide what we should do.
##---------------------------------------------------------------------
##
#if($xcontext.getAction() != 'view')
  ## The administration application includes this page so we will not do anything.
#elseif(!$isAdmin &amp;&amp; "#isUserReportedSpammer($mail.values())" != 'false')
  ## The current user has been reported as a spammer, they are not allowed to send more mail until
  ## the situation has been investigated.

  ## A message which you sent was reported as spam and your privilege to send mail has been suspended...
  (%id="invitation-permission-error"%)((({{error}}$msg.get('xe.invitation.userIsReportedSpammer'){{/error}})))
  ##
#elseif(!$isAdmin
        &amp;&amp; $config.get('allowUsersOfOtherWikis') != '1'
        &amp;&amp; $doc.getWiki() != $xwiki.getDocument($xcontext.getUser()).getWiki())
  ## Users of other subwikis are not allowed to send mail.
  (%id="invitation-permission-error"%)((({{error}}$msg.get('xe.invitation.onlyMembersCanSendMail')
  $msg.get('xe.invitation.youAreAMemberOfOtherWiki', [$xwiki.getDocument($xcontext.getUser()).getWiki()]){{/error}})))
#else
  ## The user is authorized to send mail &lt;-------------------------------------------------------
  ## Get the list of email addresses to send to.
  #set($userMaySendToMultiple = ($isAdmin || $config.get('usersMaySendToMultiple') == '1'))
  #set($recipientString = $escapetool.xml("$!request.get('recipients')"))
  #set($recipients = [])
  #getRecipients($recipientString, $userMaySendToMultiple, $recipients)
  ##
  ## get subject line and message body if allowed...
  #set($userMayPersonalizeMessage = ($isAdmin || $config.get('usersMayPersonalizeMessage') == '1'))
  #if($userMayPersonalizeMessage)
    #set($subjectLine = $request.get('subjectLine'))
    #set($messageBody = $request.get('messageBody'))
  #else
    #set($subjectLine = '')
    #set($messageBody = '')
  #end
  ##
  #if("$!request.get('sendMail')" != '' &amp;&amp; $request.getMethod().toLowerCase() == 'post')
    #generateAndSendMail($config,
                         $recipients,
                         $subjectLine,
                         $messageBody)
    ## Reload mail so footer information is correct.
    #set($mail = {})
    #loadInvitationMail($config, $mail)
  #else
    ## The user wants to write and preview a message.
    #displayForm($recipientString,
                 $subjectLine,
                 $messageBody,
                 $userMaySendToMultiple,
                 $userMayPersonalizeMessage)
    #set($messages = [])
    ## No recipients ('',) because we are just creating it to preview.
    #set($emailContainer = $xwiki.getDocumentAsAuthor($config.get('emailContainer')))
    #generateMailFromTemplate($config.get('subjectLineTemplate'),
                              $config.get('messageBodyTemplate'),
                              $config.get('emailClass'),
                              [],
                              $config.get('emailRegex'),
                              $subjectLine,
                              $messageBody,
                              $messages,
                              $emailContainer)
    #set($invalidAddresses = [])
    #validateAddressFormat($recipients, $config.get('emailRegex'), $invalidAddresses)
    #displayMessage($messages.get(0), $recipients, $invalidAddresses)
  #end
  #invitationFooter($mail, $request.getParameterMap(), $isAdmin, $config)
#end##if user has permission to send
##
##---------------------------------------------------------------------
## The macros (Nothing below this point is run directly)
##---------------------------------------------------------------------
##
#*
 * Generate and send an email message.
 *
 * $messages (List&lt;XObject&gt;) a list of invitation email messages.
 *
 * $config (XObject) configuration for the inviter.
 *
 * $emailContainer (Document) the document contaning the mail message.
 *###
#macro(generateAndSendMail, $config, $recipients, $messageSubject, $messageContent)
  #set($messages = [])
  #set($emailContainer = $xwiki.getDocumentAsAuthor($config.get('emailContainer')))
  #generateMailFromTemplate($config.get('subjectLineTemplate'),
                            $config.get('messageBodyTemplate'),
                            $config.get('emailClass'),
                            $recipients,
                            $config.get('emailRegex'),
                            $messageSubject,
                            $messageContent,
                            $messages,
                            $emailContainer)
  ##
  #if($messages.size() &gt; 0)
    #sendMail($messages, $config, $emailContainer)
    #set($errors = [])
    #foreach($message in $messages)
      #set($status = $message.getProperty('status').getValue())
      #if($status != 'pending')
        #set($discard = $errors.add($message))
      #end
    #end
    (%class="invitation"%)(((

      (%id="invitation-action-message"%)(((##
      #if($errors.size() &gt; 0)
        ## An error has occured while sending the message.
        {{error}}$msg.get('xe.invitation.errorWhileSending'){{/error}}##
      #else
        ## Your message has been sent.
        {{info}}$msg.get('xe.invitation.successSending'){{/info}}##
      #end
      )))

      #displayMessageTable($messages, ['sentDate', 'recipient', 'status'])
     )))
    #displayMessage($messages.get(0), $recipients)
  #else


    (%id="invitation-action-message"%)((({{error}}$msg.get('xe.invitation.noValidMessagesToSend'){{/error}})))

  #end
#end
#*
 * Send an email message.
 *
 * $messages (List&lt;XObject&gt;) a list of invitation email messages.
 *
 * $config (XObject) configuration for the inviter.
 *
 * $emailContainer (Document) the document contaning the mail messages.
 *###
#macro(sendMail, $messages, $config, $emailContainer)
  ##
  ## Get mail sender plugin.
  #set($sender = $xwiki.get('mailsender'))
  ##
  ## If parameters are set in the local config, use them, otherwise use global defaults.
  #set($senderConfig = $sender.createMailConfiguration($xwiki))
  #if("$!config.get('smtp_server')" != '')
    $senderConfig.setHost($config.get('smtp_server'))##
  #end
  #if("$!config.get('smtp_port')" != '')
    $senderConfig.setPort($mathtool.toInteger($config.get('smtp_port')))##
  #end
  #if("$!config.get('smtp_server_username')" != '')
    $senderConfig.setSmtpUsername($config.get('smtp_server_username'))##
  #end
  #if("$config.containsKey('smtp_server_password')" != '')
    $senderConfig.setSmtpPassword($config.get('smtp_server_password'))##
  #end
  #if("$config.containsKey('javamail_extra_props')" != '')
    $senderConfig.setExtraProperties($config.get('javamail_extra_props'))##
  #end
  ##
  #foreach($message in $messages)
    #set($mailObj = $sender.createMail())
    ##
    #if("$config.get('from_address')" != '')
      $mailObj.setFrom($config.get('from_address'))##
    #end
    ##
    ## Set recipients
    #set($recipient = $message.getProperty('recipient').getValue())##
    $mailObj.setTo($recipient)##
    ##
    ## Set the subject line and message body.
    $mailObj.setSubject($message.getProperty('subjectLine').getValue())##
    ##
    ## If text part is not set then we get an NPE when trying to craft a multipart message.
    $mailObj.setTextPart('')##
    ## Put all in email div so that we can apply CSS only to the email and not to the preview.
    $mailObj.setHtmlPart("&lt;div style='font-size:87.5%;'&gt;$message.getProperty('messageBody').getValue()&lt;/div&gt;")##
    ##
    ## Send the message
    #if("$sender.sendMail($mailObj, $senderConfig)" != 0)
      #setMessageStatus($message, 'sendingFailed')##
    #else
      #setMessageStatus($message, 'pending', $msg.get('xe.invitation.messageSentLogEntry'))##
    #end
    ## Comment = "Added Email Message."
    $emailContainer.saveAsAuthor($msg.get('xe.invitation.sendMail.addMessageSaveComment'))
  #end
#end
##
#*
 * Generate invitation XObjects from a template, user input, and a set of recipients.
 *
 * $subjectLineTemplate (String) this will be evaluated as velocity and placed in the email subject line.
 *                               You may refer to $messageID and $subjectLine in the code.
 *
 * $messageBodyTemplate (String) this will be evaluated as velocity and placed in the email message body.
 *                               You may refer to $messageID, $messageBody, You may also use xwiki2.0 syntax
 *                               in the template.
 *
 * $emailClass (String) the document name of the XClass representing email messages.
 *
 * $recipients (List&lt;String&gt;) email addresses to send this message to.
 *
 * $emailRegex (String) the regular expression to validate the email addresses against. Undefined behavior will result
 *                      from an invalid expression.
 *
 * $userSuppliedSubject (String) the message subject. This can be modified or ignored by the template.
 *
 * $userSuppliedContent (String) the message content. This can be modified or ignored by the template.
 *
 * $messages (List&lt;XObject&gt;) this list will be populated with mail objects for each recipient.
 *
 * $emailContainer (Document) the document where the mail object will be stored for later review.
 *###
#macro(generateMailFromTemplate, $subjectLineTemplate, $messageBodyTemplate, $emailClass, $recipients, $emailRegex, 
                                 $userSuppliedSubject, $userSuppliedContent, $messages, $emailContainer)
  #if($recipients &amp;&amp; $recipients.size() &gt; 0)
    #set($sendTo = [])
    #set($discard = $sendTo.addAll($recipients))
    #set($invalid = [])
    #validateAddressFormat($recipients, $emailRegex, $invalid)
    #set($discard = $sendTo.removeAll($invalid))
    #set($messageGroupID = $mathtool.getRandom())
  #else
    ## If we're just doing a test run, no recipients but we still want to generate a message.
    #set($sendTo = [''])
  #end
  ##
  #foreach($recipient in $sendTo)
    #set($message = $emailContainer.newObject($emailClass))
    $message.set('sendingUser', $context.getUser())##
    $message.set('sentDate', '')##
    $message.set('messageGroupID', $messageGroupID)##
    $message.set('recipient', $recipient)##
    ## Set the message id to a random number string, set it to $messageID variable so it can be used by the template.
    #set($messageID = "$mathtool.getRandom().toString().replaceAll('\.','')##
                       $mathtool.getRandom().toString().replaceAll('\.','')##
                       $mathtool.getRandom().toString().replaceAll('\.','')")
    $message.set('messageID', $messageID)##
    ##
    ## Need to make $subjectLine and $messageBody available to $doc.getRenderedContent.
    #set($subjectLine = "$!userSuppliedSubject")
    #set($messageBody = "$!userSuppliedContent")
    ##
    ## Generate the message from the template - html in the subject line is ignored by the mail client.
    $message.set('subjectLine', "$doc.getRenderedContent($subjectLineTemplate, 'xwiki/2.0', 'plain/1.0')")##
    $message.set('messageBody', "$doc.getRenderedContent($messageBodyTemplate, 'xwiki/2.0')")##
    #set($discard = $messages.add($message))
  #end
#end
##
#*
 * Check the format of an email address against a regular expression.
 *
 * $allAddresses (List&lt;String&gt;) The list of addresses to validate.
 *
 * $emailRegex (String) The regular expression to validate the email addresses agains. Undefined behavior will result
 *                      from an invalid expression.
 *
 * $invalidAddresses (List&lt;String&gt;) this List will be populated with addresses from $allAddresses which are invalid.
 *###
#macro(validateAddressFormat, $allAddresses, $emailRegex, $invalidAddresses)
  #foreach($address in $allAddresses)
    #if("$!address" == '')
      ## Empty address, do nothing.
    #elseif(!$xcontext.getUtil().match($emailRegex, $address))
      #set($discard = $invalidAddresses.add($address))
    #end
  #end
#end
##
#*
 * Display a form for typing up an invitation email.
 *
 * $recipientString (String) what should be filled in to the field for recipients.
 *
 * $subjectLine (String) what should be put in the subject line by default.
 *
 * $messageBody (String) what should be put in the content of the message by default.
 *
 * $userMaySendToMultiple (Boolean) true if the current user has permission send to multiple addresses at once.
 *
 * $userMayPersonalizeMessage (Boolean) true if the user may add their own subject line and message content.
 *###
#macro(displayForm, $recipientString, $subjectLine, $messageBody, $userMaySendToMultiple, $userMayPersonalizeMessage)

  {{html clean="false" wiki="false"}}
  &lt;form id="invitation-sender-form" action="$doc.getURL('view')" method="post" class="invitation"&gt;
   &lt;dl&gt;
    ## Who you are inviting:
    &lt;dt&gt;&lt;label for="recipients"&gt;$msg.get('xe.invitation.toLabel')&lt;/label&gt;&lt;/dt&gt;
    ## If the user has edit access on this document, then we should allow them to send to multiple email addresses.
    #if($userMaySendToMultiple)
      &lt;dd&gt;
       &lt;textarea cols="75" name="recipients" rows="3" id="recipients"&gt;##
        $!recipientString##
       &lt;/textarea&gt;
      &lt;/dd&gt;
    #else
      &lt;dd&gt;&lt;input type="text" size="54" name="recipients" id="recipients" value="$!recipientString" /&gt;&lt;/dd&gt;
    #end
    #if($userMayPersonalizeMessage)
       ## Subject line:
       &lt;dt&gt;&lt;label for="subjectLine"&gt;$msg.get('xe.invitation.subjectLabel')&lt;/label&gt;&lt;/dt&gt;
       &lt;dd&gt;
        &lt;input type="text" size="54" name="subjectLine" id="subjectLine" value="$!escapetool.html($!subjectLine)" /&gt;
       &lt;/dd&gt;
       ## Invitation message:
       &lt;dt&gt;&lt;label for="messageBody"&gt;$msg.get('xe.invitation.contentLabel')&lt;/label&gt;&lt;/dt&gt;
       &lt;dd&gt;
        &lt;textarea cols="75" name="messageBody" rows="10" id="messageBody"&gt;##
         $!escapetool.xml($!messageBody)##
        &lt;/textarea&gt;
       &lt;/dd&gt;
    #end
   &lt;/dl&gt;
   &lt;div class="bottombuttons"&gt;
    &lt;div class="buttons"&gt;
     &lt;span class="buttonwrapper"&gt;
      ## Preview
      &lt;input type="submit" class="button" name="preview" value="$msg.get('xe.invitation.displayForm.preview')" /&gt;
     &lt;/span&gt;
     &lt;span class="buttonwrapper"&gt;
      ## Send Mail
      &lt;input type="submit" class="button" name="sendMail" value="$msg.get('xe.invitation.displayForm.sendMail')" /&gt;
     &lt;/span&gt;
    &lt;/div&gt;
   &lt;/div&gt;
  &lt;/form&gt;
  {{/html}}

#end
##
#*
 * Has mail sent by the current user been reported as spam?
 * will return 'false' if not otherwise will return 'true'
 * if a message was reported as spam but an admin has marked the situation
 * as handled then this macro will return 'false'
 *
 * $messages (Collection&lt;XObject&gt;) objects representing all email messages.
 *###
#macro(isUserReportedSpammer, $messages)
  #set($out = 'false')
  #foreach($message in $messages)
     #if($message.getProperty('sendingUser').getValue() == $xcontext.getUser()
          &amp;&amp; $message.getProperty('status').getValue() == 'reported')
     ##
       #set($out = 'true')
     #end
  #end
  $out##
#end
##
#*
 * Get the list of recipients from the user input string.
 * Splits on space but is tolerent of commas.
 * Each email in the list may only appear in the output once (no duplicates.)
 *
 * $recipientString (String) the String input by the user eg: "alice@example.com bob@example.com"
 *
 * $userMaySendToMultiple (Boolean) is the user allowed to send to multiple addresses at once?
 *
 * $recipientsOut (List&lt;String&gt;) is populated with one or more email addresses.
 *###
#macro(getRecipients, $recipientString, $userMaySendToMultiple, $recipientsOut)
  #if($userMaySendToMultiple)
    #set($recipientsArray = $recipientString.replaceAll(', ', ' ').split(' '))
    #set($recipientMap = {})
    #foreach($recip in $recipientsArray)
      #set($discard = $recipientMap.put($recip, 0))
    #end
    #set($discard = $recipientsOut.addAll($recipientMap.keySet()))
  #else
    ## If the user can't edit this page, we won't let them sent to multiple addresses.
    #set($discard = $recipientsOut.add($recipientString))
  #end
#end
{{/velocity}}</content></xwikidoc>
