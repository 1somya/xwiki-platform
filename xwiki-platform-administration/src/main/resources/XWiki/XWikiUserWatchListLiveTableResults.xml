<?xml version="1.0" encoding="UTF-8"?>

<xwikidoc>
<web>XWiki</web>
<name>XWikiUserWatchListLiveTableResults</name>
<language></language>
<defaultLanguage>en</defaultLanguage>
<translation>0</translation>
<parent>XWiki.XWikiUserWatchListSheet</parent>
<creator>XWiki.Admin</creator>
<author>XWiki.Admin</author>
<customClass></customClass>
<contentAuthor>XWiki.Admin</contentAuthor>
<creationDate>1249395964000</creationDate>
<date>1249395964000</date>
<contentUpdateDate>1249395964000</contentUpdateDate>
<version>1.1</version>
<title></title>
<template></template>
<defaultTemplate></defaultTemplate>
<validationScript></validationScript>
<comment></comment>
<minorEdit>false</minorEdit>
<syntaxId>xwiki/2.0</syntaxId>
<hidden>false</hidden>
<content>{{velocity wiki="false"}}
#if($context.action == 'get')
##
## Constants
##
#set($wikiType = 'wiki')
#set($spaceType = 'space')
#set($pageType = 'page')
##
## Build watched elements list
##
#set($wikis = $xwiki.watchlist.getWatchedWikis())
#set($spaces = $xwiki.watchlist.getWatchedSpaces())
#set($pages = $xwiki.watchlist.getWatchedDocuments())
#set($elements = $util.getArrayList())
## Wikis
#foreach($wiki in $wikis)
  #if("$!wiki" != '')
    #set($wikiUrl = $xwiki.getURL("${wiki}:Main.WebHome"))
    #set($discard = $elements.add([$wiki, $wikiType, $wiki, $wikiUrl, $msg.get('watchlist.table.allspaces'), '', $msg.get('watchlist.table.alldocuments'), '']))
  #end
#end
## Spaces
#foreach($space in $spaces)
  #if("$!space" != '')
    #set($wiki = $space.substring(0, $space.indexOf(':')))
    #set($dotsindex = $space.indexOf(':') + 1)
    #set($spaceName = $space.substring($dotsindex))
    #set($wikiUrl = $xwiki.getURL("${wiki}:Main.WebHome"))
    #set($spaceUrl = $xwiki.getURL("${wiki}:${space}.WebHome"))
    #set($discard = $elements.add([$space, $spaceType, $wiki, $wikiUrl, $spaceName, $spaceUrl, $msg.get('watchlist.table.alldocuments'), '']))
  #end
#end
## Pages
#foreach($page in $pages)
  #if ("$!page" != '')
    #set($wiki = $page.substring(0, $page.indexOf(':')))
    #set($wikiUrl = $xwiki.getURL("${wiki}:Main.WebHome"))
    #set($dotsindex = $page.indexOf(':') + 1)
    #set($space = $page.substring($dotsindex, $page.indexOf('.')))
    #set($spaceUrl = $xwiki.getURL("${wiki}:${space}.WebHome"))
    #set($dotindex = $page.indexOf('.') + 1)
    #set($pageName = $page.substring($dotindex))
    #set($pageUrl = $xwiki.getURL($page))
    #set($discard = $elements.add([$page, $pageType, $wiki, $wikiUrl, $space, $spaceUrl, $pageName, $pageUrl]))
  #end
#end
##
## JSON
##
{
  "totalrows": $elements.size(),
  "reqNo"    : $!request.reqNo,
  "returnedrows": $elements.size(),
  "offset"   : $!request.offset,
  "rows": [
    #foreach($element in $elements)
      #if ($velocityCount &gt; 1),#end
      {
        "id"        : "$!listtool.get($element, 0)",
        "type"      : "$!listtool.get($element, 1)",
        "wikiName"  : "$!listtool.get($element, 2)",
        "wikiUrl"   : "$!listtool.get($element, 3)",
        "spaceName" : "$!listtool.get($element, 4)",
        "spaceUrl"  : "$!listtool.get($element, 5)",
        "pageName"  : "$!listtool.get($element, 6)",
        "pageUrl"   : "$!listtool.get($element, 7)"
      }
    #end
  ]
}
#end
{{/velocity}}</content>
</xwikidoc>
