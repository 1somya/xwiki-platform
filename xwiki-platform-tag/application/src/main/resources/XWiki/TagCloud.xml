<?xml version="1.0" encoding="ISO-8859-1"?>

<xwikidoc>
<web>XWiki</web>
<name>TagCloud</name>
<language></language>
<defaultLanguage>en</defaultLanguage>
<translation>0</translation>
<parent>Main.Tags</parent>
<creator>XWiki.Admin</creator>
<author>XWiki.Admin</author>
<customClass></customClass>
<contentAuthor>XWiki.Admin</contentAuthor>
<creationDate>1231844576000</creationDate>
<date>1239902341000</date>
<contentUpdateDate>1239902341000</contentUpdateDate>
<version>1.1</version>
<title>Tag Cloud</title>
<template></template>
<defaultTemplate></defaultTemplate>
<validationScript></validationScript>
<comment></comment>
<minorEdit>false</minorEdit>
<syntaxId>xwiki/1.0</syntaxId>
<hidden>false</hidden>
<object>
<class>
<name>XWiki.StyleSheetExtension</name>
<customClass></customClass>
<customMapping></customMapping>
<defaultViewSheet></defaultViewSheet>
<defaultEditSheet></defaultEditSheet>
<defaultWeb></defaultWeb>
<nameField></nameField>
<validationScript></validationScript>
<cache>
<cache>0</cache>
<displayType>select</displayType>
<multiSelect>0</multiSelect>
<name>cache</name>
<number>5</number>
<prettyName>Caching policy</prettyName>
<relationalStorage>0</relationalStorage>
<separator> </separator>
<separators> ,|</separators>
<size>1</size>
<unmodifiable>0</unmodifiable>
<values>long|short|default|forbid</values>
<classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>
</cache>
<code>
<name>code</name>
<number>2</number>
<prettyName>Code</prettyName>
<rows>20</rows>
<size>50</size>
<unmodifiable>0</unmodifiable>
<classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>
</code>
<name>
<name>name</name>
<number>1</number>
<prettyName>Name</prettyName>
<size>30</size>
<unmodifiable>0</unmodifiable>
<classType>com.xpn.xwiki.objects.classes.StringClass</classType>
</name>
<parse>
<displayFormType>select</displayFormType>
<displayType>yesno</displayType>
<name>parse</name>
<number>4</number>
<prettyName>Parse content</prettyName>
<unmodifiable>0</unmodifiable>
<classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>
</parse>
<use>
<cache>0</cache>
<displayType>select</displayType>
<multiSelect>0</multiSelect>
<name>use</name>
<number>3</number>
<prettyName>Use this extension</prettyName>
<relationalStorage>0</relationalStorage>
<separator> </separator>
<separators> ,|</separators>
<size>1</size>
<unmodifiable>0</unmodifiable>
<values>onDemand=On demand|always=Always</values>
<classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>
</use>
</class>
<name>XWiki.TagCloud</name>
<number>0</number>
<className>XWiki.StyleSheetExtension</className>
<guid>a8888c10-036f-4a37-9964-ac7691874ef6</guid>
<property>
<cache>default</cache>
</property>
<property>
<code>ol.tagCloud { 
  text-align: justify; 
  text-justify: auto;
  /* Overriding of toucan value */ 
  margin: 0;
}

div#dashboardleft ol.tagCloud { 
  /* We re-set this value here on purpose so that uses of the cloud outside of the dashboard are not affected */
  margin: 0.5em;
}

ol.tagCloud li { 
  display:inline; padding: 0 3px; 
}

ol.tagCloud .notPopular { 
  font-size:1.0em; 
}

ol.tagCloud .notVeryPopular { 
  font-size:1.1em; 
}

ol.tagCloud .somewhatPopular { 
  font-size:1.2em; 
}

ol.tagCloud .popular { 
  font-size:1.3em; 
}

ol.tagCloud .veryPopular {
  font-size:1.4em; 
}

ol.tagCloud .ultraPopular {
  font-size:1.5em; 
}</code>
</property>
<property>
<name></name>
</property>
<property>
<parse>0</parse>
</property>
<property>
<use>onDemand</use>
</property>
</object>
<content>##
## Tag cloud.
## 
## @param tagCloudSpace - the space to display the tag cloud for. If blank, display cloud for the whole wiki. Default is blank.
##
## Configurable popularity levels. You must an even number of levels. Default: 6.
##
#set($popularityLevels = ["notPopular", "notVeryPopular", "somewhatPopular", "popular", "veryPopular", "ultraPopular"])
$xwiki.ssx.use("XWiki.TagCloud")
##
## Get tag count map. Key: tag, value: number of occurrences.
## Store the minimum number of occurrences for a tag.
## Store the maximum number of occurrences for a tag.
##
#set($tagCount = $xwiki.tag.getTagCount("$!tagCloudSpace"))
#set($sortedTagCounts = $sorttool.sort($tagCount.values()))
#set($maxIndex = $sortedTagCounts.size() - 1)
#set($minCount = $listtool.get($sortedTagCounts, 0))
#set($maxCount = $listtool.get($sortedTagCounts, $maxIndex))
##
## Calculate the total number of tags in the wiki.
##
#set($totalTagNumber = 0)
#foreach($currentTagCount in $sortedTagCounts)
  #set($totalTagNumber = $totalTagNumber + $currentTagCount)
#end
##
## Build popularity map using the difference between minimum maximum tag occurrences counts
## and the average tag occurences count.
##
#set($countAverage = $mathtool.div($totalTagNumber, $tagCount.size()))
#set($levelsHalf = $popularityLevels.size() / 2)
#set($firstHalfCountDelta = $mathtool.sub($countAverage, $minCount))
#set($secondHalfCountDelta = $mathtool.sub($maxCount, $countAverage))
#set($popularityMap = $util.getHashMap())
#set($firstHalfIntervalSize = $mathtool.div($firstHalfCountDelta, $levelsHalf))
#set($secondHalfIntervalSize = $mathtool.div($secondHalfCountDelta, $levelsHalf))
#set($previousPopularityMax = $minCount)
#set($intervalSize = $firstHalfIntervalSize)
#set($halfPassed = false)
#foreach($popularityLevel in $popularityLevels)
  #if($velocityCount &gt; $levelsHalf &amp;&amp; !$halfPassed)
    #set($intervalSize = $secondHalfIntervalSize)
    #set($halfPassed = true)
  #end
  #set($currentPopularityMax = $mathtool.add($previousPopularityMax, $intervalSize))
  #set($discard = $popularityMap.put($currentPopularityMax, $popularityLevel))
  #set($previousPopularityMax = $currentPopularityMax)
#end
##
## Display tag cloud.
##
#if($tagCount.size() &gt; 0)
  &lt;ol class="tagCloud"&gt;
    #foreach($tag in $tagCount.keySet())
      ## This hackish loop could be made simpler with #break (introduced in velocity 1.6)
      #set($classSet = false)
      #foreach($popularityMax in $sorttool.sort($popularityMap.keySet()))
        #if($tagCount.get($tag) &gt; $popularityMax)
        #elseif(!$classSet)
          #set($liClass = $popularityMap.get($popularityMax))
          #set($classSet = true)
        #end
      #end
      &lt;li class="$liClass"&gt;&lt;a class="tag" href="$xwiki.getURL("Main.Tags", "view", "do=viewTag&amp;amp;tag=$tag")" title="$msg.get("xe.tag.tooltip", ["${tagCount.get($tag)}"])"&gt;$tag&lt;/a&gt;&lt;/li&gt;
    #end
  &lt;/ol&gt;
#else
  #if("$!tagCloudSpace" == "")
    $msg.get("xe.tag.notags")
  #else
    $msg.get("xe.tag.notagsforspace", ["$tagCloudSpace"])
  #end
#end</content>
</xwikidoc>
