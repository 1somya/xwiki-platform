<?xml version="1.0" encoding="utf-8"?> 
<document>  
	<properties>  
		<author email="jk AT jkraemer.net">Jens Kraemer</author>
		<title>XWiki eMail notify plugin - Installation</title>
	</properties>  
	<meta name="keyword" content="xwiki, email, notification, plugin"/> 
	<body>
		<section name="Installation (Binary distribution)">
			<subsection name="Install required files">
				<p>
					Unpack the distribution archive and copy xwiki-emailnotify-plugin-x.y.jar and all 
          the jars from the lib directory to WEB-INF/lib inside your xwiki webapp.
				</p>
				<p>
					Copy the file <a href="notificationMail.vm">notificationMail.vm</a> (located inside 
          the docs directory of the distribution)
					to WEB-INF/classes inside your xwiki webapp. This is the template used
          for notification emails, you can modify it as you like.
				</p>
        <p>Now configure your notification intervals. There is a sample config file 
          <a href="emailnotification.properties">here</a>. This can also be found in 
          the docs directory of the distribution and needs to be copied to WEB-INF/classes, 
          too. This file can contain any number of different interval declarations. Each 
          interval is defined by a property starting with 
          <code>emailnotificationthread.</code>. What comes after the dot will later be 
          used as the name of the interval. The property values are cron-like expressions 
          as described in the 
          <a href="http://wiki.opensymphony.com/display/QRTZ1/CronTriggers+Tutorial">Quartz wiki</a>.</p>
        <p>
          Now you need to make the subscribe/unsubscribe functions accessible for your users.
          The relevant velocity snippet is contained in the file 
          <a href="emailnotify_actions.vm">emailnotify_actions.vm</a> (also located inside 
          the docs directory of the distribution). In the default Xwiki 
          Skin (as of Version 0.9) there are several places where this could be included,
          i.e. the <em>More Actions</em> menu, the toolbar to the right, or the menu to 
          the left. The snippet renders three links: one for (un)subscribing the current page,
          one for the current web and one for toggling subscription of the whole wiki.
        </p>
        <p>Probably the easiest way is to include the snippet is the Toolbar: Just login 
          as admin and edit the page named Xwiki.Toolbar. Insert the content of 
          emailnotify_actions.vm above the code rendering the rss links. Or 
          copy the file to the templates directory of your XWiki installation, and simply 
          insert the line <code>#template("emailnotify_actions.vm")</code> into the 
          toolbar document instead of cut'n pasting the whole file. 
          </p>
          <p>Integration of the subscription links in other places works similarly, just
          make sure the snippet is included in some place where it is accessible from each 
          page. The <em>more actions</em> menu is, unlike the toolbar, part of 
          the XWiki skin, so to get the links included there you have to modify the 
          original XWiki skin or create your own. The document XWiki.MySkin of your 
          Wiki might be a good starting point. The <em>more actions</em> menu is 
          located in the so called <em>view header</em>.
         </p>
			</subsection>
			<subsection name="XWiki configuration ">
				<p> 
					Edit xwiki.cfg (located in the WEB-INF dir of your xwiki web application directory) 
					and add the full class name of the plugin to the xwiki.plugins property:
					<source>xwiki.plugins=com.xpn.xwiki.plugin.calendar.CalendarPlugin,net.jkraemer.xwiki.plugins.emailnotify.EmailNotificationPlugin</source>
				</p>
				<p>
					The velocity snippet mentioned above makes use of some message keys:
				</p>
				<ul>
					<li>
						emailnotifications=Headline of the menu section
						unsubscribepage=Menuitem to unsubscribe the current page
						subscribepage=Menuitem to subscribe the current page
						unsubscribeweb=Menuitem to unsubscribe the current web
						subscribeweb=Menuitem to subscribe the current web
						unsubscribewiki=Menuitem to unsubscribe the whole wiki
						subscribewiki=Menuitem to subscribe the whole wiki
					</li>
				</ul>
				<p><a href="messages_de.properties">German</a> and <a href="messages_en.properties">english</a> messages are provided. To use them, add the contents of the files to the corresponding WEB-INF/classes/ApplicationResources_{de,en}.properties file.</p>
				<p>
					Finally you should set the "Admin email" and "Outgoing SMTP Server" properties in 
					your global xwiki preferences ("registration" section). The first is used as 
					sender address for the mails generated by the plugin, the latter tells xwiki 
					which server we use for outgoing mails.
				</p>
				<p>Now restart the application server.</p>
			</subsection>
			<subsection name="Trouble shooting">
				<p>
					In case of any problems (i.e. not receiving any mails) set 
          <source>log4j.logger.net.jkraemer.xwiki=debug</source> 
					in your WEB-INF/classes/log4j.properties, restart the server and try to reproduce 
          the problem, i.e. change pages you know another user is subscribed to. The 
          process of filtering pages and compiling the mails for subscribed users is logged
          in high detail. Don't hesitate to contact me if you think you found a bug!
				</p>
			</subsection>
		</section>
	</body>
</document>