#set($parents = $util.arrayList)
#set($discard = $parents.add($doc.fullName))
#macro(computeHierarchy $doc $result $level)
  #set($parent = $doc.parent)
  #if(($parent != '') && ($level < 6) && (!$parents.contains($parent)))
    #set($discard = $parents.add($parent))
    #set($pdoc = $xwiki.getDocument($parent).getTranslatedDocument())
    #set($pdocurl = $pdoc.getURL("view"))
    #set($nstring = "<a href='$pdocurl'>$xwiki.getXMLEncoded(${pdoc.displayTitle})</a> <span class='separator'>&raquo;</span> $result")
    #set($level = $level + 1)
    #computeHierarchy($pdoc $nstring $level)
  #else
    $result
  #end
#end
#if($context.getMode()==0) ## Visible only in a page
  <div id="hierarchy">
    <span class="currentSpace"><a href="$spaceViewUrl">$xwiki.getXMLEncoded(${doc.space})</a>: </span>
#computeHierarchy($doc "<a href='${doc.getURL('view')}'>$xwiki.getXMLEncoded($tdoc.displayTitle)</a>" 0)
  </div>
#end
