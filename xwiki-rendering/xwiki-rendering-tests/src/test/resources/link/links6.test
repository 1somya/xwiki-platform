.#-----------------------------------------------------
.input|xwiki/2.0
.# [[{{macro}}]]					a macro as label
.# [[Label>Reference]]				just a reference, the > need to be double to be matched as a link syntax
.# [[Reference|Param=Value]]		just a reference,  the | need to be double to be matched as a link syntax
.# [[[[no link]]>>Not Reference]]	only images are valid sub-links syntaxes
.# [[[[image:whatever>>Reference]]	only images are valid sub-links syntaxes
.# not:link							not matched as a link 
.#-----------------------------------------------------
[[{{macro}}]]
[[Label>Reference]]
[[Reference|Param=Value]]
[[[[no link]]>>Not Reference]]
[[[[image:whatever>>Reference]]
not:link
.#-----------------------------------------------------
.expect|event/1.0
.#-----------------------------------------------------
beginDocument
beginParagraph
beginLink [Reference = [{{macro}}]] [false]
endLink [Reference = [{{macro}}]] [false]
onNewLine
beginLink [Reference = [Label>Reference]] [false]
endLink [Reference = [Label>Reference]] [false]
onNewLine
beginLink [Reference = [Reference|Param=Value]] [false]
endLink [Reference = [Reference|Param=Value]] [false]
onNewLine
beginLink [Reference = [[[no link]] [false]
endLink [Reference = [[[no link]] [false]
onSpecialSymbol [>]
onSpecialSymbol [>]
onWord [Not]
onSpace
onWord [Reference]
onSpecialSymbol []]
onSpecialSymbol []]
onNewLine
beginLink [Reference = [Reference]] [false]
onSpecialSymbol [[]
onSpecialSymbol [[]
onImage: [whatever] [true]
endLink [Reference = [Reference]] [false]
onNewLine
onWord [not]
onSpecialSymbol [:]
onWord [link]
endParagraph
endDocument
.#-----------------------------------------------------
.expect|xhtml/1.0
.#-----------------------------------------------------
<p><span class="wikicreatelink"><a href="/xwiki/bin/edit/{{macro}}?parent=xwiki%3ASpace.Page"><span class="wikigeneratedlinkcontent">{{macro}}</span></a></span><br/><span class="wikicreatelink"><a href="/xwiki/bin/edit/Label&gt;Reference?parent=xwiki%3ASpace.Page"><span class="wikigeneratedlinkcontent">Label&gt;Reference</span></a></span><br/><span class="wikicreatelink"><a href="/xwiki/bin/edit/Reference|Param=Value?parent=xwiki%3ASpace.Page"><span class="wikigeneratedlinkcontent">Reference|Param=Value</span></a></span><br/><span class="wikicreatelink"><a href="/xwiki/bin/edit/[[no link?parent=xwiki%3ASpace.Page"><span class="wikigeneratedlinkcontent">[[no link</span></a></span>&gt;&gt;Not Reference]]<br/><span class="wikicreatelink"><a href="/xwiki/bin/edit/Reference?parent=xwiki%3ASpace.Page">[[<img src="/xwiki/bin/download/currentdoc/whatever" class="wikimodel-freestanding" alt="whatever"/></a></span><br/>not:link</p>
.#-----------------------------------------------------
.expect|annotatedxhtml/1.0
.#-----------------------------------------------------
<p><!--startwikilink:{{macro}}--><span class="wikicreatelink"><a href="/xwiki/bin/edit/{{macro}}?parent=xwiki%3ASpace.Page"><span class="wikigeneratedlinkcontent">{{macro}}</span></a></span><!--stopwikilink--><br/><!--startwikilink:Label>Reference--><span class="wikicreatelink"><a href="/xwiki/bin/edit/Label&gt;Reference?parent=xwiki%3ASpace.Page"><span class="wikigeneratedlinkcontent">Label&gt;Reference</span></a></span><!--stopwikilink--><br/><!--startwikilink:Reference|Param=Value--><span class="wikicreatelink"><a href="/xwiki/bin/edit/Reference|Param=Value?parent=xwiki%3ASpace.Page"><span class="wikigeneratedlinkcontent">Reference|Param=Value</span></a></span><!--stopwikilink--><br/><!--startwikilink:[[no link--><span class="wikicreatelink"><a href="/xwiki/bin/edit/[[no link?parent=xwiki%3ASpace.Page"><span class="wikigeneratedlinkcontent">[[no link</span></a></span><!--stopwikilink-->&gt;&gt;Not Reference]]<br/><!--startwikilink:Reference--><span class="wikicreatelink"><a href="/xwiki/bin/edit/Reference?parent=xwiki%3ASpace.Page">[[<!--startimage:whatever--><img src="/xwiki/bin/download/currentdoc/whatever" class="wikimodel-freestanding" alt="whatever"/><!--stopimage--></a></span><!--stopwikilink--><br/>not:link</p>
.#-----------------------------------------------------
.expect|xwiki/2.0
.#-----------------------------------------------------
[[{{macro}}]]
[[Label>Reference]]
[[Reference|Param=Value]]
[[[[no link]]>>Not Reference]]
[[~~[~~[image:whatever>>Reference]]
not:link
.#-----------------------------------------------------
.input|xhtml/1.0
.#-----------------------------------------------------
<p><!--startwikilink:{{macro}}--><span class="wikicreatelink"><a href="/xwiki/bin/edit/{{macro}}?parent=xwiki%3ASpace.Page"><span class="wikigeneratedlinkcontent">{{macro}}</span></a></span><!--stopwikilink--><br/><!--startwikilink:Label>Reference--><span class="wikicreatelink"><a href="/xwiki/bin/edit/Label&gt;Reference?parent=xwiki%3ASpace.Page"><span class="wikigeneratedlinkcontent">Label&gt;Reference</span></a></span><!--stopwikilink--><br/><!--startwikilink:Reference|Param=Value--><span class="wikicreatelink"><a href="/xwiki/bin/edit/Reference|Param=Value?parent=xwiki%3ASpace.Page"><span class="wikigeneratedlinkcontent">Reference|Param=Value</span></a></span><!--stopwikilink--><br/><!--startwikilink:[[no link--><span class="wikicreatelink"><a href="/xwiki/bin/edit/[[no link?parent=xwiki%3ASpace.Page"><span class="wikigeneratedlinkcontent">[[no link</span></a></span><!--stopwikilink-->&gt;&gt;Not Reference]]<br/><!--startwikilink:Reference--><span class="wikicreatelink"><a href="/xwiki/bin/edit/Reference?parent=xwiki%3ASpace.Page">[[<!--startimage:whatever--><img src="/xwiki/bin/download/currentdoc/whatever" class="wikimodel-freestanding" alt="whatever"/><!--stopimage--></a></span><!--stopwikilink--><br/>not:link</p>