###
### Rename document template, step 1: choose new name + updated backlinks + updated parents
###
## TODO: check if this information should be displayed?
<h1><span>$msg.get('core.rename.title', [$xwiki.getXMLEncoded($doc.fullName)])</span></h1>
#set($newname = $msg.get("core.rename.inputPrompt"))
<form action="?xpage=rename&amp;step=2" method="post"
    onsubmit="if(this.newPageName.value=='${escapetool.xml($newname)}') this.newPageName.value=''">
  <h2><span>$msg.get("core.rename.title.newName")</span></h2>
  #set($pweb = $doc.space)
  <div class="padded">
    <table border="0">
      <tr>
        <td>
          $msg.get("core.rename.newspace")
        </td>
        <td>
          <select name="newSpaceName">
            #set ($spaces = $xwiki.getSpaces())
            #foreach ($space in $spaces)
              <option #if ($space == $pweb) selected="selected" #end>$space</option>
            #end
          </select>
        </td>
      </tr>
      <tr>
        <td>
          $msg.get("core.rename.newpage")
        </td>
        <td>
          <input type="text" name="newPageName" value="${escapetool.xml($newname)}" class="panelinput withTip"/>
        </td>
      </tr>
    </table>
  </div>
  #set($backlinks = $doc.getBacklinks())
  #if($backlinks.size() > 0)
    <h2><span>$msg.get("core.rename.title.updateDocs")</span></h2>
    #foreach($backlink in $backlinks)
      #if(!$xwiki.hasAccessLevel("edit", $context.user, $backlink))
        #set ($alink = "<a href='$xwiki.getURL($backlink)' rel='__blank' style='color: #999;'>$backlink</a>")
        <div><input type="checkbox" disabled="disabled"/> $alink</div>
      #elseif($xwiki.getDocument($backlink).isProgrammaticContent())
        #set ($alink = "<a href='$xwiki.getURL($backlink)' rel='_blank' style='color: #900;'>$backlink</a>")
        <div><input type="checkbox" name="backlink_$backlink"/> $alink</div>
      #else
        #set ($alink = "<a href='$xwiki.getURL($backlink)' rel='_blank'>$backlink</a>")
        <div><input type="checkbox" name="backlink_$backlink" checked="checked"/> $alink</div>
      #end
    #end
  #end
  #set($children = $doc.getChildren())
  #if($children.size() > 0)
    <h2><span>$msg.get("core.rename.title.updateChildren")</span></h2>
    #foreach($child in $children)
      #if(!$xwiki.hasAccessLevel("edit", $context.user, $child))
        #set ($alink = "<a href='$xwiki.getURL($child)' rel='_blank' style='color: #999;'>$child</a>")
        <div><input type="checkbox" disabled="disabled"/> $alink</div>
      #elseif($xwiki.getDocument($backlink).isProgrammaticContent())
        #set ($alink = "<a href='$xwiki.getURL($child)' rel='_blank' style='color: #900;'>$child</a>")
        <div><input type="checkbox" name="child_$child"/> $alink</div>
      #else
        #set ($alink = "<a href='$xwiki.getURL($child)' rel='_blank'>$child</a>")
        <div><input type="checkbox" name="child_$child" checked="checked"/> $alink</div>
      #end
    #end
  #end
  <div class="padded">
    <span class="buttonwrapper"><input class="button" type="submit" name="formactionrename" value="$msg.get("core.rename.submit")"/></span>
    <span class="buttonwrapper"><input class="button" type="submit" name="action_cancel" value="$msg.get("cancel")"/></span>
  </div>
</form>
