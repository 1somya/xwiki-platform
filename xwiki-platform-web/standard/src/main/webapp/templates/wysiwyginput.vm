<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
<link type="text/css" rel="stylesheet" href="${request.contextPath}/com.xpn.xwiki.wysiwyg.Wysiwyg/RichTextArea.css"/>
##TODO: The style sheet configuration is commented out for now because it affects the behavior of the new WYSIWYG editor in a very bad way. 
##This is temporary. See http://jira.xwiki.org/jira/browse/XWIKI-2721
##<link type="text/css" rel="stylesheet" href="${request.getRequestURL().substring(0, $request.getRequestURL().indexOf("/", 9))}${xwiki.getSkinFile("style.css")}"/>
</head>
## We don't use directly $tdoc.content because we could miss the content updates 
## when we switch from wiki editor to wysiwyg.
#set($content = $tdoc.content)
#if($request.key)
#set($wysiwygInput = $request.getSession().getAttribute("com.xpn.xwiki.wysiwyg.input"))
#if($wysiwygInput.containsKey($request.key))
#set($content = $wysiwygInput.get($request.key))
#set($ok = $wysiwygInput.remove($request.key))
#end
#end
<body id="body" class="main">$tdoc.getRenderedContent($content, $tdoc.getSyntaxId())</body>
</html>
