#set($formname = "edit")
#set($saveaction = "save")
#set($previewenabled = true)
#set($xredirect=$!request.getParameter("xredirect"))
## <form id="edit" method="post" action="$doc.getURL("preview")">
## #set($editactions = "top")
## <div class="topbuttons">#template("editactions.vm")</div>
<div>
<div class="hidden">
<input type="hidden" name="template" value="$!request.template" />
#if($request.section && $request.section!="")
 #set($xcontinue=$doc.getURL("edit", "editor=wysiwyg&section=$request.section"))
#else
 #set($xcontinue=$doc.getURL("edit", "editor=wysiwyg"))
#end
<input type="hidden" name="xcontinue" value="$xcontinue"/>
<input type="hidden" name="xredirect" value="$!xredirect" />
<input type="hidden" name="language" value="$!tdoc.realLanguage" />
## <input type="hidden" id="xwikidoctitleinput" name="title" value="$!tdoc.title"/>
## <input type="hidden" id="xwikidocparentinput" name="parent" value="$!tdoc.parent"/>
</div>
<div id="xwikitext">
<div id="xwikieditcontent">
#if($xwiki.wysiwyg.isSyntaxSupported($doc.syntaxId))
## We should find a better way of including the JavaScript code of the editor!
<script type="text/javascript" src="${request.contextPath}/com.xpn.xwiki.wysiwyg.Wysiwyg/com.xpn.xwiki.wysiwyg.Wysiwyg.nocache.js"></script>
## The editor will replace the following text area with its own widget.
## If JavaScript is disabled the user will still be able to edit the document using this HTML text area.
$xwiki.getTextArea($tdoc.content)
## We put the $tdoc.content on the session to be available from wysiwyginput.vm 
## because by using directly $tdoc.content in wysiwyginput.vm we can miss the content 
## updates from this request, like when we switch from wiki editor to wysiwyg.
#set($wysiwygInput = $request.getSession().getAttribute("com.xpn.xwiki.wysiwyg.input"))
#if(!$wysiwygInput)
#set($wysiwygInput = $util.getHashMap())
$request.getSession().setAttribute("com.xpn.xwiki.wysiwyg.input", $wysiwygInput)
#end
#set($wysiwygInputKey = $util.generateRandomString(4))
#set($ok = $wysiwygInput.put($wysiwygInputKey, $tdoc.content))
<script type="text/javascript">
//<![CDATA[
    var Wysiwyg0 = {
      hookId: 'content',
      inputURL: "${tdoc.getExternalURL("view", "xpage=wysiwyginput&key=$wysiwygInputKey")}",
      syntax: "$doc.syntaxId",
      plugins: 'separator text valign list indent undo format symbol link',
      toolbar: 'bold italic underline strikethrough | subscript superscript | unorderedlist orderedlist | outdent indent | undo redo | format | hr symbol | link unlink',
      debug: #if($request.debug)'true'#else'false'#end
    };
//]]>
</script>
#else
#warning("The new GWT-based WYSIWYG editor doesn't support the syntax of the current document: <em>$doc.syntaxId</em>.")
#end
</div>
</div>
</div>
#set($editactions = "bottom")
<div class="bottombuttons">#template("editactions.vm")</div>
## </form>
