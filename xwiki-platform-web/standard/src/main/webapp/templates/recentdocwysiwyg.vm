
<div class="xwikidatacontent">
    #set($rsvc= $xwiki.xWiki.getRightService())

    #if ($request.getParameter("action"))
        #set ($action = $request.getParameter("action") )
    #else
        #set($action = "")
    #end

    #set ($start = 0)
    #set ($nb = 50)

    #if ($action == "view")
        #set ($collect = $xwiki.getRecentActions("view", 13))
        #set ($title = $msg.get("listofrecentlyviewedpages"))
    #else
        #set ($text = "")
        #set ($sql = "where doc.name like '%$text%' order by doc.date desc")
        #set ($start = 0)
        #set ($nb = 50)
        #set ($collect = $xwiki.searchDocuments($sql , $nb , $start))
        #set ($title = $msg.get("listofrecentlymodifiedpages"))
    #end

    #if ($collect.size() != 0)
        <p style="font-weight:bold"> $title : </p>
    #end
    <table width="95%" cellspacing="3px">
        #set($counter=0)
        #if ($collect.size() == 0)
            <tr>
                <td align="center">
                    <div class="warning">
                        $msg.get("warningstartspluginisnotactivated")
                    </div>
                </td>
            </tr>
        #else
            #foreach ($item in $collect)
                #if ($xwiki.hasAccessLevel("view", "${context.database}:${item}"))
                    #if($counter < 13)
                        <tr>
                            #set($bentrydoc = $xwiki.getDocument($item))
                            <td>* <a href="#" onclick="document.forms[0].wiki_page.value='$bentrydoc.name';if ('$doc.space' != '$bentrydoc.space') document.forms[0].wiki_space.value='$bentrydoc.space'; else document.forms[0].wiki_space.value=''; return false;">
                                $bentrydoc.name</a>  $msg.get("inspace") $bentrydoc.space $msg.get("wikiweb"), $msg.get("lastmodifiedby")
                                $xwiki.getUserName($bentrydoc.author) $msg.get("lastmodifiedon") $xwiki.formatDate($bentrydoc.date,"MMMM dd, yyyy HH:mm")
                            </td>
                        </tr>
                #end
            #end
            #set( $counter = $counter + 1)
            #end
        #end
    </table>
</div>