#if($xwiki.diff)
#if(($request.xpage!="changes")&&($request.viewer!="changes"))
<style type="text/css">
.diffmodifiedline {
  border-left: 8px solid #888888;
  padding-left: 10px;
}
.diffunmodifiedline {
  border-left: 8px solid #dddddd;
  padding-left: 10px;
}
.diffremoveword {
  background-color: red;
  text-decoration: line-through;
}
.diffaddword {
  background-color: lightgreen;
}
</style>
#end
<div style="width: 100%; background-color: #DDDDDD">
<h3>$msg.get("from") $msg.get("version") $origdoc.version $msg.get("to") $newdoc.version
#if(($origdoc=="")||($newdoc==""))
#if($newdoc!="")
$msg.get("editedby") $xwiki.renderText($xwiki.getLocalUserName($newdoc.author),$doc) $msg.get("on") $xwiki.formatDate($newdoc.date)
#end
 ($msg.get("cannotreaddocumentversion") $newdoc.version)</h3>
</div>
#else
$msg.get("editedby") $xwiki.renderText($xwiki.getLocalUserName($newdoc.author), $doc) $msg.get("on") $xwiki.formatDate($newdoc.date)
</h3>
</div>
#end

<ul>
#foreach($item in $doc.getMetaDataDiff($origdoc, $newdoc))
#if($item.field=="author")
<li>author:  $xwiki.getLocalUserName($item.getPrevvalue()) &gt;  $xwiki.getLocalUserName($item.getNewvalue())</li>
#else
<li>
$item.getField(): $xwiki.diff.getDifferencesAsHTML($item.getPrevValue().toString(),$item.getNewValue().toString(), false)
</li>
#end
#end
</ul>

<br /><br />
#set($text1 = $origdoc.content)
#set($text2 = $newdoc.content)
$xwiki.diff.getDifferencesAsHTML($text1,$text2,false)

<ul>
#foreach($item1 in $doc.getClassDiff($origdoc, $newdoc))
#foreach($item in $$item1)
<li>
$item.getClassName() - $item.getPropName(): $xwiki.diff.getDifferencesAsHTML($item.getPrevValue().toString(),$item.getNewValue().toString(),false)
</li>
#end
#end
</ul>

<ul>
#foreach($item1 in $doc.getObjectDiff($origdoc, $newdoc))
#foreach($item in $$item1)
<li>
$item.getClassName() - $item.getPropName(): $xwiki.diff.getDifferencesAsHTML($item.getPrevValue().toString(),$item.getNewValue().toString(),false)
</li>
#end
#end
</ul>
#else
#template("changesdocold.vm")
#end