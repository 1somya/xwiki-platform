#set($tocreate = "$!{request.getParameter('tocreate')}")
#set($title = "$!{request.getParameter('title')}")
#set($template = "$!{request.getParameter('template')}")
#set($parent = "$!{request.getParameter('parent')}")
#set($auxparams = "$!{request.getParameter('auxparams')}")
##
## Create panel
##
#if($tocreate=="panel")
  #set($docname=$title.replaceAll("/", "%2F"))
  #if($template == "")
    #set($template="Panels.PanelTemplate")
  #end
  #set($pcontent = "#")
  #set($pcontent = $pcontent.concat("panelheader('${title}')${util.getNewline()}${util.getNewline()}#"))
  #set($pcontent = $pcontent.concat("panelfooter()"))
  #set($pcontent = $util.encodeURL($pcontent))
  #set($redirectaction = "inline")
  #set($redirectparams = "template=${template}&Panels.PanelClass_0_name=${title}&Panels.PanelClass_0_content=$pcontent")
##
## Create page
##
#elseif($tocreate=="page")
  #set($docname=$title.replaceAll("/", "."))
  #set($etitle = $util.encodeURI($title))
  #set($etemplate = $util.encodeURI("${template}"))
  #set($eparent = $util.encodeURI("${parent}${auxparams}"))
  #set($redirectaction = "edit")
  #set($redirectparams = "template=${etemplate}&parent=${eparent}&title=$title")
##
## Create space
##
#elseif($tocreate=="space")
  #set($title=$title.replaceAll(" \\.\\/", ""))
  #set($docname="${title}.WebHome")
  #set($eparent = $util.encodeURI("${parent}${auxparams}"))
  ## TODO : Use a WebHome template ?
  #set($redirectaction = "edit")
  #set($redirectparams = "parent=${eparent}&title=$title")
##
## Create blog post
##
#elseif($tocreate=="post")
  #set($docname="Blog.${title.replaceAll(' ', '')}")
  #set($etitle = $util.encodeURI($title))
  #set($redirectaction = "inline")
  #set($redirectparams = "parent=Blog.WebHome&template=XWiki.ArticleClassTemplate&XWiki.ArticleClass_0_title=$etitle")
#end
##
## Send redirect
##
#set($newdoc=$xwiki.getDocument($docname))
#if(!$newdoc.isNew())
  #set($redirecturl = $newdoc.getURL("view", "xpage=docalreadyexists"))
#else
  #set($redirecturl = $newdoc.getURL($redirectaction, $redirectparams))
#end
$response.sendRedirect($redirecturl)
